---
// Cookie consent banner component with animations
---

<style is:global>
  @keyframes slideUp {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes slideDown {
    from {
      transform: translateY(0);
      opacity: 1;
    }
    to {
      transform: translateY(100%);
      opacity: 0;
    }
  }

  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }

  @keyframes shimmer {
    0% {
      background-position: -200% center;
    }
    100% {
      background-position: 200% center;
    }
  }

  @keyframes confetti-fall {
    0% {
      transform: translateY(0) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }

  #cookie-banner {
    animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  #cookie-banner.hiding {
    animation: slideDown 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  #cookie-accept {
    background: linear-gradient(
      90deg,
      #ffffff 0%,
      #f0f0f0 25%,
      #ffffff 50%,
      #f0f0f0 75%,
      #ffffff 100%
    );
    background-size: 200% auto;
    transition: all 0.3s ease;
  }

  #cookie-accept:hover {
    animation: shimmer 2s linear infinite, pulse 1s ease-in-out infinite;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
  }

  #cookie-accept:active {
    transform: scale(0.95);
  }

  #cookie-decline {
    position: relative;
    overflow: hidden;
  }

  #cookie-decline::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    transform: translateX(-100%);
    transition: transform 0.5s ease;
  }

  #cookie-decline:hover::after {
    transform: translateX(100%);
  }

  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    top: -10px;
    z-index: 100;
    pointer-events: none;
    animation: confetti-fall linear forwards;
  }

  .confetti.circle {
    border-radius: 50%;
  }

  .confetti.square {
    border-radius: 2px;
  }

  .confetti.triangle {
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-bottom: 10px solid currentColor;
    background: transparent !important;
  }
</style>

<div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-zinc-900/95 backdrop-blur-sm border-t border-zinc-800 p-4 sm:p-5 z-50 hidden">
  <div class="max-w-2xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4">
    <div class="flex items-center gap-3">
      <span class="text-2xl">üç™</span>
      <p class="text-sm text-zinc-400 text-center sm:text-left">
        We use cookies to improve your experience and remember your preferences.
      </p>
    </div>
    <div class="flex gap-3 shrink-0 w-full sm:w-auto">
      <button id="cookie-decline" class="flex-1 sm:flex-none px-5 py-2.5 text-sm text-zinc-400 hover:text-zinc-200 rounded-lg border border-zinc-700 hover:border-zinc-600 transition-all duration-300">
        Decline
      </button>
      <button id="cookie-accept" class="flex-1 sm:flex-none px-5 py-2.5 text-sm bg-white text-black font-medium rounded-lg transition-all duration-300">
        Accept
      </button>
    </div>
  </div>
</div>

<div id="confetti-container" class="fixed inset-0 pointer-events-none z-[100]"></div>

<script is:inline>
  (function() {
    const CONSENT_KEY = 'cookie-consent';
    const banner = document.getElementById('cookie-banner');
    const acceptBtn = document.getElementById('cookie-accept');
    const declineBtn = document.getElementById('cookie-decline');
    const confettiContainer = document.getElementById('confetti-container');

    const consent = localStorage.getItem(CONSENT_KEY);

    // Show banner if no consent decision yet
    if (!consent) {
      banner.classList.remove('hidden');
    }

    function createConfetti() {
      const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#95e1d3', '#f38181', '#aa96da', '#fcbad3', '#a8d8ea'];
      const shapes = ['circle', 'square', 'triangle'];
      const confettiCount = 50;

      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        const shape = shapes[Math.floor(Math.random() * shapes.length)];
        const color = colors[Math.floor(Math.random() * colors.length)];

        confetti.className = `confetti ${shape}`;
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = shape !== 'triangle' ? color : 'transparent';
        confetti.style.color = color;
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        confetti.style.animationDelay = Math.random() * 0.5 + 's';

        confettiContainer.appendChild(confetti);

        // Clean up confetti after animation
        setTimeout(() => confetti.remove(), 4500);
      }
    }

    function hideBanner(celebrate) {
      if (celebrate) {
        createConfetti();
      }
      banner.classList.add('hiding');
      setTimeout(() => {
        banner.classList.add('hidden');
        banner.classList.remove('hiding');
      }, 400);
    }

    acceptBtn.addEventListener('click', function() {
      localStorage.setItem(CONSENT_KEY, 'accepted');
      hideBanner(true);
      // Reload after animation so PostHog reinitializes with full tracking
      setTimeout(function() {
        window.location.reload();
      }, 800);
    });

    declineBtn.addEventListener('click', function() {
      localStorage.setItem(CONSENT_KEY, 'declined');
      hideBanner(false);
    });
  })();
</script>
